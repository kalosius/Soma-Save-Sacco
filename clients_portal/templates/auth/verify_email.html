{% extends "clientsbase.html" %}
{% block content %}
<style>
  a.offverify {
    display: none !important;
  }
</style>

<div class="flex items-center justify-center min-h-screen bg-gray-100">
  <div class="bg-white shadow-lg rounded-2xl p-8 max-w-md w-full">
    
    <!-- Heading -->
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">
      Verify Your Email
    </h2>
    <p class="text-center text-gray-600 mb-6">
      Enter the <strong>6-digit OTP</strong> we sent to your email.
    </p>

    <!-- Django messages -->
    {% if messages %}
      <div class="mb-4 space-y-2">
        {% for message in messages %}
          <div class="px-4 py-2 rounded-md text-sm 
            {% if message.tags == 'success' %} bg-green-100 text-green-800 
            {% elif message.tags == 'error' %} bg-red-100 text-red-800 
            {% else %} bg-gray-100 text-gray-800 {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- OTP form -->
    <form method="POST" class="space-y-4">
      {% csrf_token %}
      <div>
        <label for="otp" class="block text-sm font-medium text-gray-700">OTP Code</label>
        <input type="text" id="otp" name="otp" maxlength="6" required
          class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
      </div>

      <button type="submit" id="verifyBtn"
  class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
  
  <!-- Spinner (hidden by default) -->
  <svg id="spinner" class="hidden animate-spin h-5 w-5 text-white mr-2"
       xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10"
            stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor"
          d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
  </svg>

  <span id="btnText">Verify Email</span>
</button>

<script>
  // Show spinner when form is submitted
  const form = document.querySelector("form");
  const verifyBtn = document.getElementById("verifyBtn");
  const spinner = document.getElementById("spinner");
  const btnText = document.getElementById("btnText");

  form.addEventListener("submit", function () {
    spinner.classList.remove("hidden");
    btnText.textContent = "Verifying...";
    verifyBtn.disabled = true; // prevent double-clicks
  });
</script>

    </form>

    <!-- Resend link -->
    <!-- Resend OTP -->
    <p class="mt-4 text-center text-sm text-gray-600">
    Didnâ€™t receive the code?
    <form method="post" action="{% url 'resend_otp' %}" class="inline">
        {% csrf_token %}
        <input type="hidden" name="email" value="{{ request.session.pending_email }}">
        <button type="submit" class="text-blue-600 hover:underline">Resend OTP</button>
    </form>
    </p>
  </div>
</div>
{% endblock %}
