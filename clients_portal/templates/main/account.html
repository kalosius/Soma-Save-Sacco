{% extends 'clientsbase.html' %}
{% block content %}

<div class="max-w-6xl mx-auto mt-8 p-4 sm:p-6 lg:p-8 bg-white rounded-lg shadow-md">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">Account Overview</h2>

<!-- Account Info -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
  <div class="border rounded-lg p-4 bg-gray-50">
    <div class="text-gray-500 text-sm">Account Number</div>
    <div class="font-medium text-gray-900 text-lg">{{ account_number }}</div>
  </div>
  <div class="border rounded-lg p-4 bg-gray-50">
    <div class="text-gray-500 text-sm">Account Type</div>
    <div class="font-medium text-gray-900 text-lg">{{ account_type }}</div>
  </div>
  <div class="border rounded-lg p-4 bg-gray-50">
    <div class="text-gray-500 text-sm">Member Since</div>
    <div class="font-medium text-gray-900 text-lg">{{ member_since }}</div>
  </div>
</div>

<!-- Balances Section -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
  <div class="p-4 rounded-lg bg-blue-600 text-white shadow">
    <div class="text-sm opacity-80">Total Savings</div>
    <div class="text-2xl font-bold">UGX {{ total_savings|floatformat:0 }}</div>
  </div>
  <div class="p-4 rounded-lg bg-green-600 text-white shadow">
    <div class="text-sm opacity-80">Share Capital</div>
    <div class="text-2xl font-bold">UGX {{ share_capital|floatformat:0 }}</div>
  </div>
  <div class="p-4 rounded-lg bg-red-600 text-white shadow">
    <div class="text-sm opacity-80">Outstanding Loan</div>
    <div class="text-2xl font-bold">UGX {{ outstanding_loan|floatformat:0 }}</div>
  </div>
  <div class="p-4 rounded-lg bg-yellow-500 text-white shadow">
    <div class="text-sm opacity-80">Dividends Earned</div>
    <div class="text-2xl font-bold">UGX {{ dividends_earned|floatformat:0 }}</div>
  </div>
</div>

  <!-- Action Buttons -->
  <div class="flex flex-wrap gap-3 mb-8">
    <!-- <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Deposit Funds</button> -->
     <div x-data="{ open: false, method: '' }" class="relative">

  <!-- Deposit Button -->
  <button @click="open = true" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
    Deposit Funds
  </button>

  <!-- Modal -->
  <div 
    x-show="open" 
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40"
    x-transition
    @click.self="open = false"
  >
    <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 z-50" @click.stop>
      <h2 class="text-xl font-semibold mb-4 text-center text-gray-800">Deposit Funds</h2>

      <form method="POST" action="" class="space-y-4">
        {% csrf_token %}
        
        <!-- Amount -->
        <div>
          <label class="block text-gray-700 font-medium mb-1" for="amount">Amount (UGX)</label>
          <input type="number" name="amount" id="amount" required min="1000"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300" placeholder="Enter amount">
        </div>

        <!-- Payment Method -->
        <div>
          <label class="block text-gray-700 font-medium mb-1" for="method">Payment Method</label>
          <select name="method" id="method" required
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300"
            x-model="method"
          >
            <option value="">-- Select Method --</option>
            <option value="mobile_money">Mobile Money</option>
            <option value="bank_transfer">Bank Transfer (Card)</option>
          </select>
        </div>

        <!-- Conditional: Mobile Money Fields -->
        <div x-show="method === 'mobile_money'" x-transition class="space-y-3">
          <div>
            <label class="block text-gray-700 font-medium mb-1" for="network">Select Network</label>
            <select name="network" id="network" class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300" required>
              <option value="">-- Select Network --</option>
              <option value="mtn">MTN</option>
              <option value="airtel">Airtel</option>
            </select>
          </div>
          <div>
            <label class="block text-gray-700 font-medium mb-1" for="phone">Mobile Money Number</label>
            <input type="tel" name="phone" id="phone"
              class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300"
              placeholder="e.g. 077XXXXXXX" required>
          </div>
        </div>

        <!-- Conditional: Bank Transfer (Card) Fields -->
        <div x-show="method === 'bank_transfer'" x-transition class="space-y-3">
          <div>
            <label class="block text-gray-700 font-medium mb-1" for="card_number">Debit Card Number</label>
            <input type="text" name="card_number" id="card_number"
              class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300"
              placeholder="e.g. 4242 4242 4242 4242" required>
          </div>
          <div class="flex space-x-2">
            <div class="w-1/2">
              <label class="block text-gray-700 font-medium mb-1" for="expiry">Expiry (MM/YY)</label>
              <input type="text" name="expiry" id="expiry"
                class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300"
                placeholder="MM/YY" required>
            </div>
            <div class="w-1/2">
              <label class="block text-gray-700 font-medium mb-1" for="cvc">CVC</label>
              <input type="text" name="cvc" id="cvc"
                class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300"
                placeholder="e.g. 123" required>
            </div>
          </div>
        </div>


        <!-- Action Buttons -->
        <div class="flex justify-end space-x-2 pt-2">
          <button type="button" @click="open = false" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-gray-800">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Alpine.js -->
<script src="//unpkg.com/alpinejs" defer></script>



    <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Withdraw Funds</button>
    <button class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Send Funds</button>
    <a href="{% url 'loanrequest' %}"><button class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900">Apply for Loan</button></a>
  </div>

 <!-- Recent Transactions -->
<h3 class="text-xl font-semibold text-gray-700 mb-4">Recent Transactions</h3>
<div class="overflow-x-auto">
  <table class="min-w-full border border-gray-200 text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="border px-4 py-2 text-left text-gray-600 font-medium">Date</th>
        <th class="border px-4 py-2 text-left text-gray-600 font-medium">Type</th>
        <th class="border px-4 py-2 text-left text-gray-600 font-medium">Amount (UGX)</th>
        <th class="border px-4 py-2 text-left text-gray-600 font-medium">Status</th>
      </tr>
    </thead>
    <tbody class="text-gray-800">
      {% for tx in recent_transactions %}
        <tr>
          <td class="border px-4 py-2">{{ tx.date|date:"Y-m-d" }}</td>
          <td class="border px-4 py-2">{{ tx.type }}</td>
          <td class="border px-4 py-2">{{ tx.amount|floatformat:0 }}</td>
          <td class="border px-4 py-2 {% if 'Complete' in tx.status %}text-green-600{% elif 'Pending' in tx.status %}text-yellow-600{% else %}text-red-600{% endif %} font-medium">
            {{ tx.status }}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="text-center py-4 text-gray-500">No recent transactions</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

</div>

{% endblock %}
