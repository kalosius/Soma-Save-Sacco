{% extends 'clientsbase.html' %}
{% load humanize %}
{% block content %}

<div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 bg-white rounded-lg shadow-md mt-8">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">My Loans</h2>

  <!-- Loan Summary -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
    <div class="p-4 rounded-lg bg-blue-600 text-white shadow">
      <div class="text-sm opacity-80">Active Loans</div>
      <div class="text-2xl font-bold">{{ active_loans.count }}</div>
    </div>
    <div class="p-4 rounded-lg bg-green-600 text-white shadow">
      <div class="text-sm opacity-80">Total Borrowed</div>
      <div class="text-2xl font-bold">UGX {{ total_borrowed|intcomma }}</div>
    </div>
    <div class="p-4 rounded-lg bg-yellow-500 text-white shadow">
      <div class="text-sm opacity-80">Total Repaid</div>
      <div class="text-2xl font-bold">UGX {{ total_repaid|intcomma }}</div>
    </div>
    <div class="p-4 rounded-lg bg-red-600 text-white shadow">
      <div class="text-sm opacity-80">Outstanding Balance</div>
      <div class="text-2xl font-bold">UGX {{ outstanding_balance|intcomma }}</div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex gap-3 mb-8">
    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Apply for New Loan</button>
    <button class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900">View Repayment Schedule</button>
  </div>

  <!-- Active Loans Table -->
  <h3 class="text-xl font-semibold text-gray-700 mb-4">Active Loans</h3>
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 text-sm mb-8">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="border px-4 py-2 text-left font-medium">Loan Number</th>
          <th class="border px-4 py-2 text-left font-medium">Loan Type</th>
          <th class="border px-4 py-2 text-left font-medium">Principal (UGX)</th>
          <th class="border px-4 py-2 text-left font-medium">Interest (%)</th>
          <th class="border px-4 py-2 text-left font-medium">Tenure (Months)</th>
          <th class="border px-4 py-2 text-left font-medium">Outstanding (UGX)</th>
          <th class="border px-4 py-2 text-left font-medium">Status</th>
          <th class="border px-4 py-2 text-left font-medium">Action</th>
        </tr>
      </thead>
      <tbody class="text-gray-800">
        {% for loan in loans %}
        <tr>
          <td class="border px-4 py-2">LN-{{ loan.loan_code }}</td>
          <td class="border px-4 py-2">{{ loan.get_loan_type_display|default:"N/A" }}</td>
          <td class="border px-4 py-2">{{ loan.amount|intcomma }}</td>
          <td class="border px-4 py-2">{{ loan.interest_rate }}%</td>
          <td class="border px-4 py-2">--</td> <!-- Replace with actual tenure if available -->
          <td class="border px-4 py-2">--</td> <!-- Replace with actual outstanding if available -->
          <td class="border px-4 py-2 font-medium 
            {% if loan.loan_status == 'Approved' %}
              text-yellow-600
            {% else %}
              text-green-600
            {% endif %}
          ">
            {{ loan.loan_status }}
          </td>
          <td class="border px-4 py-2">
            <button class="text-blue-600 underline text-sm">
              {% if loan.loan_status == "Approved" %}Repay{% else %}View{% endif %}
            </button>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center py-4">No loans available.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Repayment Schedule Section (Sample Only) -->
  <h3 class="text-xl font-semibold text-gray-700 mb-4">Repayment Schedule (Loan: LN-0001)</h3>
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-300 text-sm">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="border px-4 py-2 text-left font-medium">Installment #</th>
          <th class="border px-4 py-2 text-left font-medium">Due Date</th>
          <th class="border px-4 py-2 text-left font-medium">Amount (UGX)</th>
          <th class="border px-4 py-2 text-left font-medium">Status</th>
        </tr>
      </thead>
      <tbody class="text-gray-800">
        <tr>
          <td class="border px-4 py-2">1</td>
          <td class="border px-4 py-2">2025-07-01</td>
          <td class="border px-4 py-2">250,000</td>
          <td class="border px-4 py-2 text-green-600 font-medium">Paid</td>
        </tr>
        <tr>
          <td class="border px-4 py-2">2</td>
          <td class="border px-4 py-2">2025-08-01</td>
          <td class="border px-4 py-2">250,000</td>
          <td class="border px-4 py-2 text-yellow-500 font-medium">Upcoming</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
